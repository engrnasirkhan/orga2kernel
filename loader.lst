     1                                  global loader
     2                                  
     3                                  extern kmain
     4                                  extern GDT_DESC;
     5                                  extern IDT_DESC;
     6                                  
     7                                  MODULEALIGN equ 1<<0
     8                                  MEMINFO	equ 1<<1
     9                                  FLAGS	equ MODULEALIGN | MEMINFO
    10                                  MAGIC	equ 0x1BADB002
    11                                  CHECKSUM	equ -(MAGIC + FLAGS)
    12                                  
    13                                  section	.text
    14                                  	align 4
    15                                  	
    16                                  MultiBootHeader:
    17 00000000 02B0AD1B                	dd MAGIC
    18 00000004 03000000                	dd FLAGS
    19 00000008 FB4F52E4                	dd CHECKSUM
    20                                  
    21                                  STACKSIZE equ 0x4000
    22                                  
    23                                  loader:
    24 0000000C BC[00400000]            	mov esp, stack+STACKSIZE
    25                                  
    26 00000011 0F011D[00000000]        	lidt  [IDT_DESC]	
    27 00000018 0F0115[00000000]        	lgdt  [GDT_DESC]
    28                                  	
    29 0000001F 50                      	push eax
    30 00000020 53                      	push ebx
    31                                  
    32 00000021 9A[00000000]0800        	call 0x8:kmain
    33                                  
    34 00000028 FA                      	cli
    35                                  
    36                                  hang:
    37 00000029 F4                      	hlt
    38 0000002A E9FAFFFFFF              	jmp	hang
    39                                  
    40                                  section .bss
    41                                  
    42                                  	align 32
    43                                  stack:
    44 00000000 <res 00004000>          	resb STACKSIZE
