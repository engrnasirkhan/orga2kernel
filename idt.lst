     1                                  extern print
     2                                  	
     3                                  global IDT_DESC
     4                                  
     5                                  %define ORIGIN 0x100000
     6                                  	
     7                                  %define CG.OFFSET(x) 	(0xffff & x) | ((0xffff_0000 & x)<<32)
     8                                  %define CG.SELECTOR(x) ((0xffff & x)<<16)
     9                                  %define CG.TYPE(x) ((x & 1111b) << 40) 
    10                                  %define CG.PARAM(x) ((1_1111b & x) << 32 )
    11                                  %define CG.P 1b<<15+32
    12                                  %define CG.DPL(x) (x & 11b)<<13
    13                                  
    14                                  %include "isr.asm"
    15                              <1> extern print
    16                              <1> 	
    17                              <1> isr0:
    18 00000000 60                  <1> 	pusha
    19                              <1> 	
    20 00000001 8D05[15000000]      <1> 	lea eax, [isr0_msg]
    21 00000007 50                  <1> 	push eax
    22 00000008 E8(00000000)        <1> 	call print
    23 0000000D 81C404000000        <1> 	add esp, 4
    24                              <1> 	
    25 00000013 61                  <1> 	popa
    26 00000014 CF                  <1> 	iret
    27 00000015 495352203000        <1> isr0_msg: db	"ISR 0",0	
    28                              <1> isr1:
    29 0000001B 60                  <1> 	pusha
    30                              <1> 	
    31 0000001C 8D05[30000000]      <1> 	lea eax, [isr1_msg]
    32 00000022 50                  <1> 	push eax
    33 00000023 E8(00000000)        <1> 	call print
    34 00000028 81C404000000        <1> 	add esp, 4
    35                              <1> 	
    36 0000002E 61                  <1> 	popa
    37 0000002F CF                  <1> 	iret
    38 00000030 495352203100        <1> isr1_msg: db	"ISR 1",0
    39                              <1> isr2:
    40 00000036 60                  <1> 	pusha
    41                              <1> 	
    42 00000037 8D05[4B000000]      <1> 	lea eax, [isr2_msg]
    43 0000003D 50                  <1> 	push eax
    44 0000003E E8(00000000)        <1> 	call print
    45 00000043 81C404000000        <1> 	add esp, 4
    46                              <1> 	
    47 00000049 61                  <1> 	popa
    48 0000004A CF                  <1> 	iret
    49 0000004B 495352203200        <1> isr2_msg: db	"ISR 2",0
    50                              <1> isr3:
    51 00000051 60                  <1> 	pusha
    52                              <1> 	
    53 00000052 8D05[66000000]      <1> 	lea eax, [isr3_msg]
    54 00000058 50                  <1> 	push eax
    55 00000059 E8(00000000)        <1> 	call print
    56 0000005E 81C404000000        <1> 	add esp, 4
    57                              <1> 	
    58 00000064 61                  <1> 	popa
    59 00000065 CF                  <1> 	iret
    60 00000066 495352203300        <1> isr3_msg: db	"ISR 3",0
    61                              <1> isr4:
    62 0000006C 60                  <1> 	pusha
    63                              <1> 	
    64 0000006D 8D05[81000000]      <1> 	lea eax, [isr4_msg]
    65 00000073 50                  <1> 	push eax
    66 00000074 E8(00000000)        <1> 	call print
    67 00000079 81C404000000        <1> 	add esp, 4
    68                              <1> 	
    69 0000007F 61                  <1> 	popa
    70 00000080 CF                  <1> 	iret
    71 00000081 495352203400        <1> isr4_msg: db	"ISR 4",0
    72                              <1> isr5:
    73 00000087 60                  <1> 	pusha
    74                              <1> 	
    75 00000088 8D05[9C000000]      <1> 	lea eax, [isr5_msg]
    76 0000008E 50                  <1> 	push eax
    77 0000008F E8(00000000)        <1> 	call print
    78 00000094 81C404000000        <1> 	add esp, 4
    79                              <1> 	
    80 0000009A 61                  <1> 	popa
    81 0000009B CF                  <1> 	iret
    82 0000009C 495352203500        <1> isr5_msg: db	"ISR 5",0
    83                              <1> isr6:
    84 000000A2 60                  <1> 	pusha
    85                              <1> 	
    86 000000A3 8D05[B7000000]      <1> 	lea eax, [isr6_msg]
    87 000000A9 50                  <1> 	push eax
    88 000000AA E8(00000000)        <1> 	call print
    89 000000AF 81C404000000        <1> 	add esp, 4
    90                              <1> 	
    91 000000B5 61                  <1> 	popa
    92 000000B6 CF                  <1> 	iret
    93 000000B7 495352203600        <1> isr6_msg: db	"ISR 6",0
    94                              <1> 
    95                              <1> isr7:
    96 000000BD 60                  <1> 	pusha
    97                              <1> 	
    98 000000BE 8D05[D2000000]      <1> 	lea eax, [isr7_msg]
    99 000000C4 50                  <1> 	push eax
   100 000000C5 E8(00000000)        <1> 	call print
   101 000000CA 81C404000000        <1> 	add esp, 4
   102                              <1> 	
   103 000000D0 61                  <1> 	popa
   104 000000D1 CF                  <1> 	iret
   105 000000D2 495352203700        <1> isr7_msg: db	"ISR 7",0
   106                              <1> isr8:
   107 000000D8 60                  <1> 	pusha
   108                              <1> 	
   109 000000D9 8D05[ED000000]      <1> 	lea eax, [isr8_msg]
   110 000000DF 50                  <1> 	push eax
   111 000000E0 E8(00000000)        <1> 	call print
   112 000000E5 81C404000000        <1> 	add esp, 4
   113                              <1> 	
   114 000000EB 61                  <1> 	popa
   115 000000EC CF                  <1> 	iret
   116 000000ED 495352203800        <1> isr8_msg: db	"ISR 8",0
   117                              <1> isr9:
   118 000000F3 60                  <1> 	pusha
   119                              <1> 	
   120 000000F4 8D05[08010000]      <1> 	lea eax, [isr9_msg]
   121 000000FA 50                  <1> 	push eax
   122 000000FB E8(00000000)        <1> 	call print
   123 00000100 81C404000000        <1> 	add esp, 4
   124                              <1> 	
   125 00000106 61                  <1> 	popa
   126 00000107 CF                  <1> 	iret
   127                              <1> 
   128 00000108 495352203900        <1> isr9_msg: db	"ISR 9",0
   129                              <1> isr10:
   130 0000010E 60                  <1> 	pusha
   131                              <1> 	
   132 0000010F 8D05[23010000]      <1> 	lea eax, [isr10_msg]
   133 00000115 50                  <1> 	push eax
   134 00000116 E8(00000000)        <1> 	call print
   135 0000011B 81C404000000        <1> 	add esp, 4
   136                              <1> 	
   137 00000121 61                  <1> 	popa
   138 00000122 CF                  <1> 	iret
   139                              <1> 
   140 00000123 49535220313000      <1> isr10_msg: db	"ISR 10",0
   141                              <1> isr11:
   142 0000012A 60                  <1> 	pusha
   143                              <1> 	
   144 0000012B 8D05[3F010000]      <1> 	lea eax, [isr11_msg]
   145 00000131 50                  <1> 	push eax
   146 00000132 E8(00000000)        <1> 	call print
   147 00000137 81C404000000        <1> 	add esp, 4
   148                              <1> 	
   149 0000013D 61                  <1> 	popa
   150 0000013E CF                  <1> 	iret
   151 0000013F 49535220313100      <1> isr11_msg: db	"ISR 11",0
   152                              <1> isr12:
   153 00000146 60                  <1> 	pusha
   154                              <1> 	
   155 00000147 8D05[5B010000]      <1> 	lea eax, [isr12_msg]
   156 0000014D 50                  <1> 	push eax
   157 0000014E E8(00000000)        <1> 	call print
   158 00000153 81C404000000        <1> 	add esp, 4
   159                              <1> 	
   160 00000159 61                  <1> 	popa
   161 0000015A CF                  <1> 	iret
   162                              <1> 
   163 0000015B 49535220313200      <1> isr12_msg: db	"ISR 12",0
   164                              <1> isr13:
   165 00000162 58                  <1> 	pop eax 		; error code
   166 00000163 60                  <1> 	pusha
   167 00000164 8D05[78010000]      <1> 	lea eax, [isr13_msg]
   168 0000016A 50                  <1> 	push eax
   169 0000016B E8(00000000)        <1>  	call print
   170 00000170 81C404000000        <1> 	add esp, 4
   171 00000176 61                  <1> 	popa
   172 00000177 CF                  <1> 	iret
   173 00000178 49535220313300      <1> isr13_msg: db	"ISR 13",0
   174                              <1> isr14:
   175 0000017F 60                  <1> 	pusha
   176                              <1> 	
   177 00000180 8D05[94010000]      <1> 	lea eax, [isr14_msg]
   178 00000186 50                  <1> 	push eax
   179 00000187 E8(00000000)        <1> 	call print
   180 0000018C 81C404000000        <1> 	add esp, 4
   181                              <1> 	
   182 00000192 61                  <1> 	popa
   183 00000193 CF                  <1> 	iret
   184                              <1> 
   185 00000194 49535220313400      <1> isr14_msg: db	"ISR 14",0
   186                              <1> isr15:
   187 0000019B 60                  <1> 	pusha
   188                              <1> 	
   189 0000019C 8D05[B0010000]      <1> 	lea eax, [isr15_msg]
   190 000001A2 50                  <1> 	push eax
   191 000001A3 E8(00000000)        <1> 	call print
   192 000001A8 81C404000000        <1> 	add esp, 4
   193                              <1> 	
   194 000001AE 61                  <1> 	popa
   195 000001AF CF                  <1> 	iret
   196                              <1> 
   197 000001B0 49535220313500      <1> isr15_msg: db	"ISR 15",0
   198                              <1> isr32:
   199 000001B7 60                  <1> 	pusha
   200                              <1> 	
   201 000001B8 8D05[CC010000]      <1> 	lea eax, [isr32_msg]
   202 000001BE 50                  <1> 	push eax
   203 000001BF E8(00000000)        <1> 	call print
   204 000001C4 81C404000000        <1> 	add esp, 4
   205                              <1> 	
   206 000001CA 61                  <1> 	popa
   207 000001CB CF                  <1> 	iret
   208                              <1> 
   209 000001CC 49535220333200      <1> isr32_msg: db	"ISR 32",0
   210                              <1> 
   211                              <1> 
   212                              <1> 
   213                              <1> 
   214                                  
   215 000001D3 00<rept>                times (0x8-(($-$$) & 111b)) db 0
   216                                  	
   217                                  BEGIN_IDT:
   218                                  	;; isr 0
   219 000001D8 00000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr0-$$+ORIGIN ) | CG.SELECTOR(0x8)
   220                                  	;; isr 1
   221 000001E0 1B000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr1-$$+ORIGIN ) | CG.SELECTOR(0x8)
   222                                  	;; isr 2
   223 000001E8 36000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr2-$$+ORIGIN ) | CG.SELECTOR(0x8)
   224                                  	;; isr 3
   225 000001F0 51000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr3-$$+ORIGIN ) | CG.SELECTOR(0x8)
   226                                  	;; isr 4
   227 000001F8 6C000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr4-$$+ORIGIN ) | CG.SELECTOR(0x8)
   228                                  	;; isr 5
   229 00000200 87000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr5-$$+ORIGIN ) | CG.SELECTOR(0x8)
   230                                  	;; isr 6
   231 00000208 A2000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr6-$$+ORIGIN ) | CG.SELECTOR(0x8)
   232                                  	;; isr 7
   233 00000210 BD000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr7-$$+ORIGIN ) | CG.SELECTOR(0x8)
   234                                  	;; isr 8
   235 00000218 D8000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr8-$$+ORIGIN ) | CG.SELECTOR(0x8)
   236                                  	;; isr 9
   237 00000220 F3000800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr9-$$+ORIGIN ) | CG.SELECTOR(0x8)
   238                                  	;; isr 10
   239 00000228 0E010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr10-$$+ORIGIN ) | CG.SELECTOR(0x8)
   240                                  	;; isr 11
   241 00000230 2A010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr11-$$+ORIGIN ) | CG.SELECTOR(0x8)
   242                                  	;; isr 12
   243 00000238 46010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr12-$$+ORIGIN ) | CG.SELECTOR(0x8)
   244                                  	;; isr 13
   245 00000240 62010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr13-$$+ORIGIN ) | CG.SELECTOR(0x8)
   246                                  	;; isr 14
   247 00000248 7F010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr14-$$+ORIGIN ) | CG.SELECTOR(0x8)
   248                                  	;; isr 15
   249 00000250 9B010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr15-$$+ORIGIN ) | CG.SELECTOR(0x8)
   250                                  	;;
   251 00000258 0000000000000000-       times 15 dq 0x0
   252 00000258 <rept>             
   253 000002D0 B7010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr32-$$+ORIGIN ) | CG.SELECTOR(0x8)
   254 000002D8 B7010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr32-$$+ORIGIN ) | CG.SELECTOR(0x8)
   255 000002E0 B7010800008E1000        dq CG.P | CG.TYPE(1110b) | CG.OFFSET( isr32-$$+ORIGIN ) | CG.SELECTOR(0x8)
   256                                  END_IDT:
   257                                  IDT_SIZE:
   258 000002E8 0F01                    IDT_DESC:	dw END_IDT-BEGIN_IDT-1
   259 000002EA [D8010000]              		dd BEGIN_IDT
